<?php/* Template Name: FB Step 2 Choose Card & Box */get_header(); ?><?php	if( (!isset($_SESSION["occasion_id"]) && $_GET["type"]) ) :		$_SESSION["occasion_id"] = $_GET["type"];	endif;	if( (!isset($_SESSION["occasion_name"]) && $_GET["typename"]) ) :		$_SESSION["occasion_name"] = $_GET["typename"];	endif;	$editScript = '';?><?php if ( have_posts() ) : while ( have_posts() ) : the_post(); ?><main id="main" role="main">	<div class="container">		<div class="heading">			<h1><?php the_field('page_title'); ?></h1>		</div>		<ul id="status-bar">			<li id="step1" class="done"><a href="<?php echo do_shortcode('[site_url]'); ?>/create/"><span>Choose Occasion</span></a></li>			<li id="step2" class="active"><a><span>Design Flatterbox</span></a></li>			<li id="step3"><a><span>Customize Message</span></a></li>			<li id="step4"><a><span>Invite Flatterers</span></a></li>			<li id="step5" class="last"><a><span>Confirm</span></a></li>		</ul>		<div class="box">			<div class="direction">				<?php the_content(); ?>				<!-- NEW DESIGN -->								<?php								$card_quantities = get_terms( 'card_quantity', array(					'orderby'    => 'slug',					'hide_empty' => 0				 ) );				 				 foreach ( $card_quantities as $card_quantity ) {				 				 ?>				 				<div class="product">						<div class="product-question-content">							<a href="#" class="producttoggle plus">								<span class="initialcap"><?php echo $card_quantity->name; ?></span>								<?php the_sub_field('question'); ?>							</a>						</div>						<div class="product-answer-content semitrans">							<h4>Select Your Box</h4>							<div class="box">							<?php							$args=array(							  'card_quantity' => $card_quantity->slug,							  'post_type' => 'box_types',							  'posts_per_page' => -1							);							$my_query = null;							$my_query = new WP_Query($args);							if( $my_query->have_posts() ) {							  $i=1;							  while ($my_query->have_posts()) : $my_query->the_post(); 							  							  ?>								<div class="box-type">									<div class="box-type-image"><img src="<?php the_field('thumbnail_image'); ?>" style="width:150px;"></div>									<h3><?php the_title(); ?><br><strong>$<?php the_field('price'); ?></strong></h3>									<div class="box-color-container" id="<?php the_title(); ?>">									<?php																		if( have_rows('color_selections') ):										// loop through the rows of data										while ( have_rows('color_selections') ) : the_row();											?>																			<div class="box-color boxtoggle" id="box-color-<?php echo $i ?>" onclick="selectboxcolor(this,'<?php the_sub_field('color_name'); ?>');">											<img src="<?php the_sub_field('color_thumbnail_image'); ?>">										</div>																				<?php										$i++;										endwhile;									else :										// no rows found									endif;										?>								<input type="hidden" class="hiddenprice" value="<?php the_field('price'); ?>" />								<input type="hidden" class="hiddenlabel" value="<?php the_title(); ?>" />																			</div>								</div>								<?php							  endwhile;							}							wp_reset_query();  // Restore global post data stomped by the_post().							?>														</div>						</div>						<div class="product-card-content semitrans">							<?php echo do_shortcode('[divider]'); ?>							<h4>Select Card Style</h4>							<div class="box">								<div class="box-type card-type">									<div class="box-type-image pricetoggle"><img src="http://www.sbdcstage.com/flatterbox/wp-content/themes/flatterbox/images/fb_cards_full_blue.png" style="width:150px;"></div>									<h3>Navy</h3>								</div>								<div class="box-type card-type">									<div class="box-type-image pricetoggle"><img src="http://www.sbdcstage.com/flatterbox/wp-content/themes/flatterbox/images/fb_cards_full_tan.png" style="width:150px;"></div>									<h3>Sand</h3>								</div>							</div>						</div>						<div class="product-price-content semitrans">							<?php echo do_shortcode('[divider]'); ?>							<h2>Total: $65</h2>							<a class="btn save" href="#" onclick="selectBoxButton(this);">Select</a>						</div>					</div><!-- END PRODUCT -->				 				 				 				 <?php				 }				 				?>								<?php if (false) : ?>				<br/>				<h2>Box Style</h2>				<div style="height:auto;overflow:auto;margin-bottom:55px;">				<?php				$type = 'box_types';				$args=array(				  'post_type' => $type,				  'post_status' => 'publish',				  'orderby' => 'menu_order',				  'order' => 'ASC',				  'posts_per_page' => -1,				  'caller_get_posts'=> 1);				$my_query = new WP_Query($args);				$i = 1;				if( $my_query->have_posts() ) {				  while ($my_query->have_posts()) : $my_query->the_post(); ?>				  <div class="box-type">				  	<div class="box-type-image"><img src="<?php the_field('thumbnail_image'); ?>" style="width:150px;" /></div>				  	<h3><?php the_title(); ?> <strong>$<?php the_field('price'); ?></strong></h3>				  	<div class="box-color-container" id="<?php the_title(); ?>">					<?php					// check if the repeater field has rows of data					if( have_rows('color_selections') ):						// loop through the rows of data						while ( have_rows('color_selections') ) : the_row();							?>						<div class="box-color" id="box-color-<?php echo $i; ?>" onclick="selectboxcolor(this,'<?php the_sub_field('color_name'); ?>');">							<img src="<?php the_sub_field('color_thumbnail_image'); ?>">						</div>							<?php							//echo '-'.$_SESSION['boxtype'].'-=-'.get_the_title().'-<br/>';							//echo '-'.$_SESSION['boxcolor'].'-=-'.the_sub_field('color_name').'-<br/>';							//echo '-'.get_sub_field('color_name').'-';							if ( ( isset($_SESSION['boxtype']) && $_SESSION['boxtype'] == get_the_title() ) 									&& ( isset($_SESSION['boxcolor']) && $_SESSION['boxcolor'] == get_sub_field('color_name') ) ) :								$editScript .= 'selectboxcolor("#box-color-'.$i.'","'.get_sub_field("color_name").'");';							endif;						$i++;						endwhile;					else :						// no rows found					endif;					?>					<input type="hidden" class="hiddenprice" value="<?php the_field('price'); ?>" />					<input type="hidden" class="hiddenlabel" value="<?php the_title(); ?>" />					</div>				  </div>					<?php				  endwhile;				}				wp_reset_query();  // Restore global post data stomped by the_post().				?>				</div>				<div>					<div class="cardcolor">						<h2>Card Color</h2>						<br/>						<div class="sentiment" id="sentiment">						</div>						<div class="box-color-container">							<?php 								if ( isset($_SESSION['boxcolor']) && !empty($_SESSION['boxcolor']) ) :									$editScript .= 'selectcardcolor("#card-color-'.$_SESSION['cardcolor'].'", "'.$_SESSION['cardcolor'].'");';								endif;							?>							<div class="card-color selected-card-color" id="card-color-Blue" onclick="selectcardcolor(this, 'Blue');">								<img src="<?php echo do_shortcode('[site_url]'); ?>/wp-content/themes/flatterbox/images/fb_cards_blue.png">							</div>							<div class="card-color" id="card-color-Tan" onclick="selectcardcolor(this, 'Tan');">								<img src="<?php echo do_shortcode('[site_url]'); ?>/wp-content/themes/flatterbox/images/fb_cards_tan.png">							</div>						</div>					</div>					<div class="numberofcards">					<h2># of Cards</h2><br/>					<div>						<?php 							if ( isset($_SESSION['cardquantity']) && !empty($_SESSION['cardquantity']) ) :								$editScript .= 'selectcardquantity("#card-quantity-'.$_SESSION['cardquantity'].'", '.$_SESSION['cardquantity'].');';							endif;						?>						<div class="card-quantity-image selected-card-quantity" id="card-quantity-50" onclick="selectcardquantity(this,50);">							<h4>Up to<h4>							<h2>50</h2>							<h4>Cards</h4>							<h3><strong>$25</strong></h3>						</div>						<div class="card-quantity-image" id="card-quantity-100" onclick="selectcardquantity(this,100);">							<h4>Up to<h4>							<h2>100</h2>							<h4>Cards</h4>							<h3><strong>$50</strong></h3>						</div>						<div class="card-quantity-image" id="card-quantity-200" onclick="selectcardquantity(this,200);">							<h4>Up to<h4>							<h2>200</h2>							<h4>Cards</h4>							<h3><strong>$100</strong></h3>						</div>					</div>					</div>				</div><?php endif; ?>			</div>			<div class="styles">				<div class="hold">					<h2>Order Summary</h2>					<table tableborder="0" cellspacing="5" cellpadding="5">						<tr>							<td>Box <span id="boxlabel"></span> (<span id="boxcolor">No Color</span>)</td>							<td><span class="math">=</span></td>							<td>$<span id="boxprice">0</span>.00</td>						</tr>						<tr>							<td>Cards (<span id="cardcolor">Blue</span>)</td>							<td><span class="math">=</span></td>							<td>included</td>						</tr>						<tr>							<td>Up to <span id="cardquantity">50</span> Cards</td>							<td><span class="math">=</span></td>							<td>$<span id="cardquantityprice">25</span></td>						</tr>						<tr>							<td class="totalrow">Total Cost</td>							<td class="totalrow"><span class="math">=</span></td>							<td class="totalrow">$<span id="totalprice">25</span>.00</td>						</tr>					</table>					<input type="hidden" id="hiddenboxtype" />					<input type="hidden" id="hiddenboxprice" />					<input type="hidden" id="hiddenboxcolor" />					<input type="hidden" id="hiddencardcolor" />					<input type="hidden" id="hiddencardquantity" />					<input type="hidden" id="hiddencardprice" />					<input type="hidden" id="hiddentotalprice" />					<input type="hidden" id="hiddencardcolorimg" value="<?php echo do_shortcode('[site_url]'); ?>/wp-content/themes/flatterbox/images/fb_cards_blue.png" />					<input type="hidden" id="hiddenboxtypeimg" />				</div>			</div>		</div>		<div class="control-bar bottom">			<a href="<?php echo do_shortcode('[site_url]'); ?>/create/" class="back">Back to Occasions</a>			<a href="javascript:;" class="btn save" onclick="goToStep3();">Next</a>		</div>	</div></main><?php endwhile; endif; ?><?php 	get_footer(); 	$loggedIn = is_user_logged_in();?><script>	function selectbox(selectedbox, selectedboxlabel)	{		jQuery(".box-type-image").parent().removeClass("selected-box");		jQuery(".box-color").removeClass("selected-box-color");		jQuery("#boxlabel").html("");		jQuery("#boxcolor").html("No Color");		jQuery(selectedbox).parent().addClass("selected-box");		jQuery("#boxlabel").html(selectedboxlabel);		jQuery("#hiddenboxtypeimg").val(jQuery(".selected-box img").attr("src"));	}	function selectboxcolor(selectedcolor,selectedcolorlabel)	{		jQuery(".box-color").removeClass("selected-box-color");		jQuery("#boxcolor").html("No Color");		jQuery(selectedcolor).addClass("selected-box-color");		jQuery("#boxcolor").html(selectedcolorlabel);		jQuery(".box-type-image").parent().removeClass("selected-box");		jQuery(selectedcolor).parents(".box-color-container").parent().addClass("selected-box");		jQuery("#boxprice").html(jQuery(selectedcolor).siblings(".hiddenprice").val());		jQuery("#boxlabel").html(jQuery(selectedcolor).siblings(".hiddenlabel").val());		jQuery("#hiddenboxtypeimg").val(jQuery(".selected-box img").attr("src"));		updatesummary();	}	function selectcardcolor(selectedcolor,selectedcolorlabel)	{		jQuery(".card-color").removeClass("selected-card-color");		jQuery("#cardcolor").html("No Color");		jQuery(selectedcolor).addClass("selected-card-color");		jQuery("#cardcolor").html(selectedcolorlabel);		switch (selectedcolorlabel) {			case 'Blue':				jQuery("#sentiment").removeClass("tan");				break;			case 'Tan':				jQuery("#sentiment").addClass("tan");				break;		}		jQuery("#hiddencardcolorimg").val(jQuery(".selected-card-color img").attr("src"));				populatehidden();	}		var qtySelected = 50;	function selectcardquantity(selectedcardquantity,qty)	{		jQuery(".card-quantity-image").removeClass("selected-card-quantity");		jQuery(selectedcardquantity).addClass("selected-card-quantity");		qtySelected = qty;		updatesummary();	}	function updatesummary(boxprice)	{		var newboxprice = 0;		if(boxprice)		{		jQuery("#boxprice").html(boxprice);			newboxprice = boxprice;		} else {			newboxprice = jQuery("#boxprice").html();		}		var totalprice = 0;		var cardprice = 0;		var cardquantity = qtySelected;				switch (cardquantity) {			case 50:				cardprice = 25;				console.log(cardquantity);				console.log(cardprice);				break;			case 100:				cardprice = 50;				console.log(cardquantity);				console.log(cardprice);				break;			case 200:				cardprice = 100;				console.log(cardquantity);				console.log(cardprice);				break;		}		totalprice = Number(newboxprice) + Number(cardprice);		jQuery("#totalprice").html(totalprice);		jQuery("#cardquantity").html(cardquantity);		jQuery("#cardquantityprice").html(cardprice);		populatehidden();	}	function populatehidden()	{		jQuery("#hiddenboxtype").val(jQuery("#boxlabel").html());		jQuery("#hiddenboxtypeimg").val(jQuery(".selected-box .box-type-image img").attr('src'));		jQuery("#hiddenboxprice").val(jQuery("#boxprice").html());		jQuery("#hiddenboxcolor").val(jQuery("#boxcolor").html());		jQuery("#hiddencardcolor").val(jQuery("#cardcolor").html());		jQuery("#hiddencardquantity").val(jQuery("#cardquantity").html());		jQuery("#hiddencardprice").val(jQuery("#cardquantityprice").html());		jQuery("#hiddentotalprice").val(jQuery("#totalprice").html());	}	function selectBoxButton(selectBtn)	{		event.preventDefault();		jQuery(".product-price-content .btn.save").removeClass("selected");		jQuery(".product-price-content .btn.save").html("select");		jQuery(selectBtn).addClass("selected");		jQuery(selectBtn).html("selected");	}	// Set Value of redirect	<?php if (empty($loggedIn) || !$loggedIn) : $_SESSION["returnURL"] = curPageURL(); endif ?>	function goToStep3()	{		if (<?php if (empty($loggedIn) || !$loggedIn) : echo 'true'; else : echo 'false'; endif; ?>) {			// Set Lightbox visible			jQuery( ".lightbox.login" ).fadeToggle("fast");			jQuery('html, body').animate({scrollTop : 0},800);		} else {			document.location='<?php echo do_shortcode('[site_url]'); ?>/flatterbox-options/?boxtype=' + jQuery("#hiddenboxtype").val() + '&boxprice=' + jQuery("#hiddenboxprice").val() + '&boxcolor=' + jQuery("#hiddenboxcolor").val() + '&cardcolor=' + jQuery("#hiddencardcolor").val() + '&cardquantity=' + jQuery("#hiddencardquantity").val() + '&cardquantityprice=' + jQuery("#hiddencardprice").val() + '&totalprice=' + jQuery("#hiddentotalprice").val() + '&cardcolorimg=' + jQuery("#hiddencardcolorimg").val() + '&boxtypeimg=' + jQuery("#hiddenboxtypeimg").val();		}	}</script><!-- NEW DESIGN --><script>jQuery( ".producttoggle" ).click(function() {	event.preventDefault();	jQuery(this).parent().siblings('.product-answer-content').slideToggle("fast");	jQuery(this).toggleClass("minus");});jQuery( ".boxtoggle" ).click(function() {	event.preventDefault();	jQuery(this).parents('.product-answer-content').siblings('.product-card-content').slideToggle("fast");	// jQuery(this).toggleClass("minus");});jQuery( ".pricetoggle" ).click(function() {	event.preventDefault();	jQuery(this).parents().siblings('.product-price-content').slideToggle("fast");	// jQuery(this).toggleClass("minus");});</script><?php echo '<script type="text/javascript">'.$editScript.'</script>'; ?>